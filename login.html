<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TCHAT - ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
    <link rel="stylesheet" href="./style.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="./config.js"></script>
    <script src="./api.js"></script>
  </head>
  <body class="rtl min-h-screen bg-background text-foreground">

    <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© -->
    <main class="container mx-auto flex min-h-screen items-center justify-center px-4 py-12">
      <div class="w-full max-w-md">
        <div class="mb-8 text-center">
          <h1 class="text-heading-lg font-bold text-foreground">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ</h1>
          <p class="text-body-sm text-muted-foreground mt-2">Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</p>
        </div>

        <div class="rounded-xl border bg-card text-card-foreground shadow-sm">
          <div class="space-y-6 px-6 py-8">
            <form class="space-y-5" id="login-form" novalidate>
              <div class="space-y-2">
                <label for="username" class="text-body-sm font-medium text-foreground">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                <div class="relative">
                  <input
                    id="username"
                    type="text"
                    required
                    autocomplete="username"
                    class="flex h-11 w-full rounded-lg border border-input bg-background px-4 pr-11 text-body-md text-foreground placeholder:text-muted-foreground shadow-sm transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
                    placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"
                  />
                  <i data-lucide="user" class="pointer-events-none absolute right-4 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"></i>
                </div>
              </div>

              <div class="space-y-2">
                <label for="password" class="text-body-sm font-medium text-foreground">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <div class="relative">
                  <input
                    id="password"
                    type="password"
                    required
                    autocomplete="current-password"
                    class="flex h-11 w-full rounded-lg border border-input bg-background px-4 pr-11 text-body-md text-foreground placeholder:text-muted-foreground shadow-sm transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
                    placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
                  />
                  <button type="button" id="toggle-password" class="absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground transition hover:text-foreground">
                    <i data-lucide="eye" class="h-4 w-4"></i>
                  </button>
                  <i data-lucide="lock" class="pointer-events-none absolute right-4 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"></i>
                </div>
              </div>

              <button
                type="submit"
                class="inline-flex w-full items-center justify-center gap-2 rounded-lg bg-primary px-4 py-3 text-button-md font-semibold text-primary-foreground shadow-sm transition-colors hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"
                disabled
              >
                <span class="text-button-md font-semibold">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
                <i data-lucide="arrow-left" class="h-4 w-4"></i>
              </button>
            </form>

            <p class="text-center text-body-sm text-muted-foreground">Â© 2025 TCHAT - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
          </div>
        </div>
      </div>
    </main>

    <script>
      const passwordInput = document.getElementById('password');
      const togglePasswordBtn = document.getElementById('toggle-password');
      const submitBtn = document.querySelector('button[type="submit"]');
      const defaultButtonTemplate = '<span class="text-button-md font-semibold">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span><i data-lucide="arrow-left" class="h-4 w-4"></i>';

      // ØªÙØ¹ÙŠÙ„/Ø¥Ù„ØºØ§Ø¡ ØªÙØ¹ÙŠÙ„ Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
      function toggleLoginButton() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        submitBtn.disabled = !(username.trim() && password.trim());
      }

      // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø­Ù‚ÙˆÙ„
      document.getElementById('username').addEventListener('input', toggleLoginButton);
      document.getElementById('password').addEventListener('input', toggleLoginButton);

      // ØªØ¨Ø¯ÙŠÙ„ Ø¥Ø¸Ù‡Ø§Ø± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
      togglePasswordBtn.addEventListener('click', () => {
        const isPassword = passwordInput.type === 'password';
        passwordInput.type = isPassword ? 'text' : 'password';
        togglePasswordBtn.innerHTML = isPassword
          ? '<i data-lucide="eye-off" class="h-4 w-4"></i>'
          : '<i data-lucide="eye" class="h-4 w-4"></i>';
        lucide.createIcons();
        passwordInput.focus();
      });

      // Ù…Ø¹Ø§Ù„Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
      document.getElementById('login-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="text-button-md font-semibold">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</span><i data-lucide="loader-2" class="h-4 w-4 animate-spin"></i>';
        
        try {
          // Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Backend (Ù†ÙØ³ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¹Ø±Ù‘Ù ÙÙŠ api.js / VITE_API_URL)
          const response = await fetch(`${API_BASE_URL}/auth/login`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              username: username,
              password: password
            })
          });
          
          const data = await response.json();
          
          if (data.success) {
            // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ù€ JWT tokens
            localStorage.setItem('tchat_logged_in', 'true');
            localStorage.setItem('tchat_user', JSON.stringify(data.user));
            localStorage.setItem('access_token', data.access_token);
            localStorage.setItem('refresh_token', data.refresh_token);
            
            console.log('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­');
            console.log('ğŸ“Œ Access Token:', data.access_token ? 'ØªÙ… Ø§Ù„Ø­ÙØ¸' : 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
            console.log('ğŸ“Œ Refresh Token:', data.refresh_token ? 'ØªÙ… Ø§Ù„Ø­ÙØ¸' : 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
            
            // ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            window.location.href = './dashboard.html';
          } else {
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¹Ù†Ø¯ Ø§Ù„ÙØ´Ù„
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            toggleLoginButton();
            
            // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø§Ù‡ØªØ²Ø§Ø²
            const form = document.getElementById('login-form');
            form.style.animation = 'shake 0.5s ease-in-out';
            setTimeout(() => {
              form.style.animation = '';
            }, 500);
          }
        } catch (error) {
          console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', error);
          
          // ÙÙŠ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù…Ø­Ù„ÙŠ
          if (username === 'admin' && password === 'admin') {
            localStorage.setItem('tchat_logged_in', 'true');
            localStorage.setItem('tchat_user', JSON.stringify({
              username: 'admin',
              full_name: 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…',
              email: 'admin@tchat.com'
            }));
            window.location.href = './dashboard.html';
          } else {
            // ØªØ£Ø«ÙŠØ± Ø§Ù‡ØªØ²Ø§Ø² Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø·Ø£
            const form = document.getElementById('login-form');
            form.style.animation = 'shake 0.5s ease-in-out';
            setTimeout(() => {
              form.style.animation = '';
            }, 500);
          }
        } finally {
          // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø±
          submitBtn.disabled = false;
          submitBtn.innerHTML = defaultButtonTemplate;
          lucide.createIcons();
        }
      });

      // ØªÙ‡ÙŠØ¦Ø© Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Lucide
      document.addEventListener('DOMContentLoaded', function() {
        lucide.createIcons();
        toggleLoginButton();
        
        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¬Ù„Ø³Ø© Ù…Ù†ØªÙ‡ÙŠØ©
        const urlParams = new URLSearchParams(window.location.search);
        const message = urlParams.get('message');
        if (message) {
          // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø§Ù„Ø±Ø³Ø§Ù„Ø©
          const alertDiv = document.createElement('div');
          alertDiv.className = 'mb-4 rounded-lg border border-amber-200 bg-amber-50 p-4 text-body-sm text-amber-800';
          alertDiv.innerHTML = `
            <div class="flex items-center gap-2">
              <i data-lucide="alert-circle" class="h-4 w-4"></i>
              <span>${decodeURIComponent(message)}</span>
            </div>
          `;
          
          // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù‚Ø¨Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
          const form = document.getElementById('login-form');
          form.parentNode.insertBefore(alertDiv, form);
          lucide.createIcons();
          
          // Ù…Ø³Ø­ Ø§Ù„Ù€ URL Ù…Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©
          window.history.replaceState({}, document.title, window.location.pathname);
        }
      });
    </script>
  </body>
</html>
